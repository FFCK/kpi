<?phpinclude_once('../commun/MyPage.php');include_once('../commun/MyBdd.php');include_once('../commun/MyTools.php');// Gestion des Evenementsclass GestionJournal extends MyPageSecure	 {		function Load()	{		if ($profile <= 2)		{			$theLimit = utyGetSession('theLimit', 50);			if (isset($_POST['theLimit']))				$theLimit = $_POST['theLimit'];			$_SESSION['theLimit'] = $theLimit;			$this->m_tpl->assign('theLimit', $theLimit);						$theUser = utyGetSession('theUser', '');			if (isset($_POST['theUser']))				$theUser = $_POST['theUser'];			$_SESSION['theUser'] = $theUser;			$this->m_tpl->assign('theUser', $theUser);						$theAction = utyGetSession('theAction', '');			if (isset($_POST['theAction']))				$theAction = $_POST['theAction'];			$_SESSION['theAction'] = $theAction;			$this->m_tpl->assign('theAction', $theAction);			$theSaison = utyGetSession('theSaison', '');			if (isset($_POST['theSaison']))				$theSaison = $_POST['theSaison'];			$_SESSION['theSaison'] = $theSaison;			$this->m_tpl->assign('theSaison', $theSaison);			$theCompet = utyGetSession('theCompet', '');			if (isset($_POST['theCompet']))				$theCompet = $_POST['theCompet'];			$_SESSION['theCompet'] = $theCompet;			$this->m_tpl->assign('theCompet', $theCompet);			// Chargement des Evenements			$myBdd = new MyBdd();			$sql  = "Select j.Id, j.Dates, j.Users, j.Actions, j.Saisons, j.Competitions, j.Evenements, j.Journees, j.Matchs, j.Journal, ";			$sql .= "u.Identite, u.Fonction ";			$sql .= "From gickp_Journal j, gickp_Utilisateur u ";			$sql .= "Where u.Code = j.Users ";			$sql .= "And j.Users Like '".$theUser."%' ";			$sql .= "And j.Actions Like '".$theAction."%' ";			$sql .= "And j.Saisons Like '".$theSaison."%' ";			$sql .= "And j.Competitions Like '".$theCompet."%' ";			$sql .= "Order By j.Dates Desc ";	 			$sql .= "Limit $theLimit ";	 					$result = mysql_query($sql, $myBdd->m_link) or die ("Erreur Load");			$num_results = mysql_num_rows($result);						$arrayJournal = array();			for ($i=0;$i<$num_results;$i++)			{				$row = mysql_fetch_array($result);					array_push($arrayJournal, array( 'Id' => $row['Id'], 							'Dates' => $row['Dates'],  							'Identite' => $row['Identite'],  							'Fonction' => $row['Fonction'],  							'Actions' => $row['Actions'],  							'Saisons' => $row['Saisons'],  							'Competitions' => $row['Competitions'],  							'Evenements' => $row['Evenements'],  							'Journees' => $row['Journees'],  							'Matchs' => $row['Matchs'],  							'Journal' => $row['Journal']));			}			$this->m_tpl->assign('arrayJournal', $arrayJournal);			// Chargement des Utilisateurs			$myBdd = new MyBdd();			$sql  = "Select Distinct j.Users, u.Identite, u.Fonction ";			$sql .= "From gickp_Journal j, gickp_Utilisateur u ";			$sql .= "Where u.Code = j.Users ";			$sql .= "Order By u.Identite ";	 					$result = mysql_query($sql, $myBdd->m_link) or die ("Erreur Load");			$num_results = mysql_num_rows($result);						$arrayUsers = array();			for ($i=0;$i<$num_results;$i++)			{				$row = mysql_fetch_array($result);					array_push($arrayUsers, array( 'Code' => $row['Users'], 							'Identite' => $row['Identite'],  							'Fonction' => $row['Fonction']));			}			$this->m_tpl->assign('arrayUsers', $arrayUsers);		}	}		function GestionJournal()	{				  MyPageSecure::MyPageSecure(2);				$alertMessage = '';				$Cmd = '';		if (isset($_POST['Cmd']))			$Cmd = $_POST['Cmd'];		$ParamCmd = '';		if (isset($_POST['ParamCmd']))			$ParamCmd = $_POST['ParamCmd'];		if (strlen($Cmd) > 0)		{			if ($Cmd == 'Add')				($_SESSION['Profile'] <= 2) ? $this->Add() : $alertMessage = 'Vous n avez pas les droits pour cette action.';							if ($alertMessage == '')			{				header("Location: http://".$_SERVER['HTTP_HOST'].$_SERVER['PHP_SELF']);					exit;			}		}		$this->SetTemplate("Journal", "Utilisateurs", false);		$this->Load();		$this->m_tpl->assign('AlertMessage', $alertMessage);		$this->DisplayTemplate('GestionJournal');	}}		  	$page = new GestionJournal();?>